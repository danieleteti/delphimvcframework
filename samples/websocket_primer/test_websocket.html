<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test Client</h1>
    <div>
        <label>URL: <input type="text" id="url" value="ws://localhost:8080/ws/echo" size="40"></label>
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
    </div>
    <div>
        <label>Message: <input type="text" id="message" value="Hello WebSocket!" size="40"></label>
        <button onclick="sendMessage()">Send</button>
    </div>
    <div>
        <h3>Log:</h3>
        <pre id="log" style="border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll;"></pre>
    </div>

    <script>
        let ws = null;

        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function connect() {
            const url = document.getElementById('url').value;
            log(`Connecting to ${url}...`);

            try {
                ws = new WebSocket(url);

                ws.onopen = function(event) {
                    log('✓ Connected!');
                };

                ws.onmessage = function(event) {
                    log(`← Received: ${event.data}`);
                };

                ws.onerror = function(error) {
                    log(`✗ Error: ${error}`);
                };

                ws.onclose = function(event) {
                    log(`✗ Disconnected. Code: ${event.code}, Reason: ${event.reason}`);
                };
            } catch (e) {
                log(`✗ Exception: ${e.message}`);
            }
        }

        function disconnect() {
            if (ws) {
                log('Disconnecting...');
                ws.close(1000, 'User requested');
                ws = null;
            }
        }

        function sendMessage() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                const message = document.getElementById('message').value;
                log(`→ Sending: ${message}`);
                ws.send(message);
            } else {
                log('✗ Not connected!');
            }
        }
    </script>
</body>
</html>
